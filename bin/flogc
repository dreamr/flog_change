#!/usr/bin/env ruby
# encoding: utf-8

lib = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)

require 'flog_change'
require 'flog_change/sample_cleaner'
require 'flog_change/graph_generator'

# Destroy old samples!
FlogChange::SampleCleaner.clean

# Flog that shit and dump the results to a sample
run_on_dir = File.expand_path(ARGV[0], __FILE__)
puts ["FLOGGING #{run_on_dir}. It may take a few moments",
      "to build the results of your UGLY code and to",
      "generate your graph."].join(" ")

`find #{run_on_dir} -name \*.rb | xargs bundle exec flog -bdg > ./samples/#{Time.now.to_i}.sample`

# create graph html from the last 2 flog samples
FlogChange::GraphGenerator.generate

open("./tmp/inde.html")
